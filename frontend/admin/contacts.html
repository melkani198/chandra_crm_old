<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contacts - Chandra CRM</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:Inter,sans-serif;
    background:linear-gradient(135deg,#0f172a,#1e1b4b,#0f172a);
    color:#fff;
}
.layout{display:flex;min-height:100vh;}
.sidebar{width:260px;background:#0f172a;padding:20px;}
.main{flex:1;padding:30px;}
.card{
    background:rgba(255,255,255,0.05);
    border-radius:15px;
    padding:20px;
    margin-bottom:20px;
}
input,select{
    width:100%;
    padding:10px;
    margin-bottom:10px;
    border:none;
    border-radius:8px;
}
button{
    padding:10px 15px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
.btn-primary{background:#06b6d4;color:white;}
.table{
    width:100%;
    border-collapse:collapse;
}
.table th,.table td{
    padding:12px;
    border-bottom:1px solid rgba(255,255,255,0.1);
}
.badge{
    padding:5px 10px;
    border-radius:15px;
    font-size:12px;
}
.badge-new{background:#3b82f6;}
.badge-connected{background:#10b981;}
.badge-dnc{background:#ef4444;}
.badge-callback{background:#f59e0b;}
</style>
</head>

<body>

<div class="layout">

<div class="sidebar">
    <h2>Chandra CRM</h2>
    <a href="admin-dashboard.html">Dashboard</a><br><br>
    <a href="campaigns.html">Campaigns</a><br><br>
    <a href="contacts.html">Contacts</a><br><br>
</div>

<div class="main">

<h1>Contact Manager</h1>

<!-- Add Contact -->
<div class="card">
<h3>Add Contact</h3>

<input type="text" id="first_name" placeholder="First Name">
<input type="text" id="last_name" placeholder="Last Name">
<input type="text" id="phone" placeholder="Phone">
<input type="email" id="email" placeholder="Email">

<select id="campaign_id"></select>

<button class="btn-primary" onclick="createContact()">Add Contact</button>
</div>

<!-- Contact List -->
<div class="card">
<h3>All Contacts</h3>

<table class="table" id="contactTable">
<thead>
<tr>
<th>Name</th>
<th>Phone</th>
<th>Campaign</th>
<th>Status</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>

</div>
</div>

<script>

const API="/chandra_crm/php-backend";

function getToken(){
    return localStorage.getItem("token");
}

async function apiCall(endpoint,method="GET",body=null){
    const opt={
        method,
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer "+getToken()
        }
    };
    if(body) opt.body=JSON.stringify(body);

    const res=await fetch(API+endpoint,opt);
    return res.json();
}

// Load Campaign Dropdown
async function loadCampaigns(){
    const data=await apiCall("/campaigns");
    const select=document.getElementById("campaign_id");
    select.innerHTML="";
    data.forEach(c=>{
        select.innerHTML+=`<option value="${c.id}">${c.name}</option>`;
    });
}

// Load Contacts
async function loadContacts(){
    const data=await apiCall("/contacts");
    const tbody=document.querySelector("#contactTable tbody");
    tbody.innerHTML="";

    data.forEach(c=>{
        let badgeClass="badge-new";
        if(c.status==="connected") badgeClass="badge-connected";
        if(c.status==="dnc") badgeClass="badge-dnc";
        if(c.status==="callback") badgeClass="badge-callback";

        tbody.innerHTML+=`
        <tr>
            <td>${c.first_name} ${c.last_name||""}</td>
            <td>${c.phone}</td>
            <td>${c.campaign_name||"-"}</td>
            <td><span class="badge ${badgeClass}">${c.status}</span></td>
        </tr>
        `;
    });
}

// Create Contact
async function createContact(){
    await apiCall("/contacts","POST",{
        first_name:document.getElementById("first_name").value,
        last_name:document.getElementById("last_name").value,
        phone:document.getElementById("phone").value,
        email:document.getElementById("email").value,
        campaign_id:document.getElementById("campaign_id").value
    });
    loadContacts();
}

window.onload=()=>{
    loadCampaigns();
    loadContacts();
}

</script>

</body>
</html>

